-- ================================================================
-- 報酬率を20%に修正するスクリプト（完璧版）
-- ================================================================
--
-- 使用タイミング:
-- 既にservicesテーブルが存在し、間違った報酬率が設定されている場合
--
-- 実行手順:
-- 1. https://supabase.com/dashboard にアクセス
-- 2. プロジェクト選択 → SQL Editor
-- 3. このファイルの内容をコピー&ペースト
-- 4. Run をクリック
--
-- ================================================================

-- 全サービスの報酬率を20%に統一
UPDATE services
SET
    default_commission_rate = 20.00,  -- 粗利の20%
    default_referral_rate = 0.00,
    updated_at = NOW()
WHERE status = 'active';

-- 確認クエリ
SELECT
    name as "サービス名",
    default_commission_rate as "報酬率(%)",
    default_referral_rate as "紹介率(%)",
    subscription_price as "月額料金(円)",
    status as "ステータス",
    updated_at as "更新日時"
FROM services
ORDER BY name;

-- ================================================================
-- 期待される結果:
-- ================================================================
--
-- | サービス名   | 報酬率(%) | 紹介率(%) | 月額料金(円) | ステータス | 更新日時           |
-- |-------------|----------|----------|------------|---------|------------------|
-- | TaskMate AI | 20.00    | 0.00     | 2980       | active  | 2025-10-24 ...   |
-- | LiteWEB+    | 20.00    | 0.00     | 4980       | active  | 2025-10-24 ...   |
--
-- ================================================================

-- 修正された件数を確認
SELECT
    '✅ 修正完了！' as status,
    COUNT(*) as "修正されたサービス数"
FROM services
WHERE status = 'active' AND default_commission_rate = 20.00;
